<%= content_for(:title, "#{@race.name} - #{t 'official_sub_menu.summary' }") %>
<h2><%= t 'official_sub_menu.summary' %></h2>
<%= flash_error %>
<%= flash_success %>
<% if @race.series.empty? %>
  <%= highlight_info(t('.no_series_for_race')) %>
<% elsif @race.competitors.empty? %>
  <%= highlight_info(t('.no_competitors_for_race')) %>
<% end %>
<% unless @race.finished? or @race.start_date > Time.zone.today or @race.competitors.empty? %>
  <div class="action_box">
    <%= render :partial => "official/finish_races/form", :locals => { :race => @race } %>
  </div>
<% end %>
<% if offline? and @race.finished? %>
  <div class="action_box">
    <%= link_to t('.publish_race_to_internet'), new_official_race_exports_path(@race) %>
  </div>
<% end %>
<% unless @race.series.empty? %>
  <table cellspacing="0" border="1">
    <tr>
      <th><%= t :series %></th>
      <th colspan="2" class="center"><%= t 'activerecord.models.competitor.other' %></th>
      <th><%= t :start_list %></th>
      <th colspan="2" class="center"><%= t :results %></th>
      <th class="center"><%= t :correct_distances %></th>
      <th>&nbsp;</th>
    </tr>
    <% @race.series.includes(:competitors => [:shots, :series]).each do |s| %>
      <tr>
        <td><%= s.name %></td>
        <% competitor_count = s.competitors.count %>
        <% if competitor_count > 0 %>
          <td class="center"><%= link_to t("competitors.people_short",
              :count => competitor_count), official_series_competitors_path(s) %></td>
          <td class="center"><%= link_to t(:add_new),
              new_official_series_competitor_path(s) %></td>
          <td class="center"><%= yes_or_empty(s.has_start_list?) do
              link_to t('.create_start_list'), official_series_competitors_path(s)
            end %></td>
          <% if s.has_start_list? %>
            <% finished_count = s.finished_competitors_count %>
            <td>
              <%= yes_or_empty(finished_count == competitor_count,
                "#{finished_count}/#{competitor_count}") do
                "#{finished_count}/#{competitor_count}"
              end %>
            </td>
            <td><%= link_to t('.input_results'), official_race_quick_saves_path(@race) %></td>
            <td class="center">
              <%= yes_or_empty(s.each_competitor_has_correct_estimates?) do
                link_to t('.set_correct_estimates'), official_race_correct_estimates_path(s.race)
              end %>
            </td>
            <td>&nbsp;</td>
          <% else %>
            <td colspan="4">&nbsp;</td>
          <% end %>
        <% else %>
          <% add_competitor_path = @race.start_order == Race::START_ORDER_MIXED ?
            official_race_start_list_path(@race) : new_official_series_competitor_path(s) %>
          <td colspan="6"><%= link_to t('.add_series_first_competitor'),
              add_competitor_path %></td>
          <td><%= link_to t('official.races.form.remove_series'), official_series_path(s), :method => :delete,
              :data => { :confirm => t('official.races.form.remove_series_confirm') } %></td>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>
<% if @race.can_destroy? %>
  <div class="action_box">
    <%= form_tag(official_race_path(@race), :method => :delete) do %>
      <%= submit_tag t('.remove_race') %>
    <% end %>
  </div>
<% end %>
<div class="action_box">
  <%= link_to t('activerecord.models.team_competition.other'), official_race_team_competitions_path(@race) %>
</div>
<div class="action_box">
  <%= link_to t('activerecord.models.relay.other'), official_race_relays_path(@race) %>
</div>
<div class="action_box">
  <%= link_to t('.edit_race_and_series'), edit_official_race_path(@race) %>
</div>
<% unless @race.series.empty? %>
  <div class="action_box">
    <%= link_to t('.add_competitors_from_csv'), new_official_race_csv_import_path(@race) %>
  </div>
<% end %>
<% unless @race.competitors.empty? %>
  <div class="action_box">
    <%= link_to t('.download_competitors_by_clubs'), official_race_clubs_competitors_path(@race, format: :pdf) %>
  </div>
<% end %>
<hr/>
<%= link_to t(:back_to_official_home_page), official_root_path %>