- content_for :title, "#{@race.name} - Toimitsijat"
%h2 Kutsu toinen henkilö tämän kilpailun toimitsijaksi
= flash_error
= flash_success
.section
  .info Henkilön täytyy olla rekisteröitynyt palveluun omalla sähköpostiosoitteellaan.
  = form_for([:official, @race, RaceRight.new], html: { class: 'invite_officials_form' } ) do |f|
    %div
      %span.form_label= label_tag :email, 'Sähköposti'
      %span= email_field_tag :email, '', size: 30
    %div
      %span.form_label= f.label :only_add_competitors, 'Anna käyttäjälle ainoastaan oikeudet lisätä kilpailijoita'
      %span= f.check_box :only_add_competitors
    #club_limitation{style: "display: none;"}
      %span.form_label= f.label :club_id, 'Salli kilpailijoiden lisäys vain tiettyyn piiriin/seuraan'
      - if @race.clubs.empty?
        (Käyttöä ei voi rajata, koska
        #{link_to 'yhtään piiriä/seuraa ei ole lisätty', official_race_clubs_path(@race)}.)
      - else
        = f.select :club_id, options_from_collection_for_select(@race.clubs, :id, :name), prompt: 'Ei rajausta'
    .submit_button
      = submit_tag "Lähetä kutsu"
:javascript
  $('#race_right_only_add_competitors').live('click', function() {
    $('#club_limitation').toggle(this.checked);
  });
%h2 Kilpailun toimitsijat
#current_officials.section
  %table
    %tr
      %th Nimi
      %th Vain kilpailijat
      %th= club_title(@race)
      %th &nbsp;
    - @race.race_rights.each do |rr|
      %tr
        %td
          = full_name(rr.user, true)
          (#{link_to rr.user.email, "mailto:#{rr.user.email}"})
        %td.center= yes_or_empty(rr.only_add_competitors?)
        %td= rr.club ? rr.club.name : raw('&nbsp;')
        %td
          - if rr.user == current_user || rr.primary?
            &nbsp;
          - else
            = link_to 'Peruuta kutsu', official_race_race_right_path(@race, rr),
              data: { confirm: "Haluatko varmasti poistaa käyttäjän toimitsijaoikeudet tähän kilpailuun?" },
              method: :delete
%hr
= link_to 'Takaisin Yhteenveto-sivulle', official_race_path(@race)
