- shooting_race = @series.sport.only_shooting?
- qualification_round = @series.sport.qualification_round
- qualification_round_shots = qualification_round && qualification_round.inject(:+) || 0
- final_round = @series.sport.final_round
- final_round_shots = final_round && final_round.inject(:+) || 0
- basic_shots = qualification_round_shots + final_round_shots
- shots_per_extra_round = @series.sport.shots_per_extra_round
- unless shooting_race
  .message.message--info= t 'official.result_place.shooting.either_total_or_shots'
- if @series.sport.inner_ten?
  .message.message--info= t 'official.result_place.shooting.inner_ten_as_eleven'
.result-cards
  - @series.competitors.each do |competitor|
    .card
      .card__number= competitor.number
      .card__middle
        .card__name
          = full_name competitor
          %span{id: "status_#{competitor.id}"}
        - unless competitor.no_result_reason
          .card__middle-row
            = form_for([:official, @series, competitor], remote: true, namespace: "c_#{competitor.id}", html: { id: "shots_form_#{competitor.id}", class: 'form form--inline' }) do |f|
              - if shooting_race
                - extra_shots_count = competitor.shots && competitor.shots.length >= basic_shots ? competitor.shots.length - basic_shots + shots_per_extra_round : 0
                = f.hidden_field :shooting_score_input
                = render partial: 'official/shots/shooting_race_shots', locals: { competitor: competitor, round_rules: qualification_round, base: 0 }
                = render partial: 'official/shots/shooting_race_shots', locals: { competitor: competitor, round_rules: final_round, base: qualification_round_shots }
                = render partial: 'official/shots/shooting_race_shots', locals: { competitor: competitor, round_rules: [extra_shots_count], base: basic_shots }
                .form__buttons= submit_tag t(:save), onclick: "start_updating(#{competitor.id})", class: 'button button--primary'
              - else
                .form__horizontal-fields
                  .card__sub-result.card__sub-result--shoot.form__field.form__field--sm
                    = f.number_field :shooting_score_input, maxlength: 3, class: 'shots-total-input'
                  .card__sub-result.card__sub-result--shoot
                    = render partial: 'official/shots/three_sports_race_shots', locals: { competitor: competitor }
                  .form__buttons= submit_tag t(:save), onclick: "start_updating(#{competitor.id})", class: 'button button--primary'
      .card__main-value{id: "shots_result_#{competitor.id}"}
        - if competitor.no_result_reason
          = competitor.no_result_reason
        - else
          = competitor.shooting_score
    :javascript
      $("#shots_form_#{competitor.id}").bind('ajax:error', function() {
        $("#update_error").html('Yhteysvirhe, yrit√§ uudelleen');
        $("#update_error").show();
        updateInlineMessage("#status_#{competitor.id}", 'error', '#{t :error}')
      });
:javascript
  $('.shots-total-input').change(function() {
    calculate_shots_result($(this).closest('.card'));
  });
  $('.shot').change(function() {
    calculate_shots_result($(this).closest('.card'));
  });
