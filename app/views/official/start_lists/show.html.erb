<% content_for :title, "Kaikkien kilpailijoiden lähtöajat" %>
<% content_for :page_title, yield(:title) %>
<h2>Kaikkien kilpailijoiden lähtöajat</h2>
<% if @all_series.length == 0 %>
  <div class="info">Yhdellekään sarjalle ei ole luotu vielä lähtölistaa</div>
<% else %>
  <div id="update_error"></div>
  <div id="competitors_table">
    <div class="header_row">
      <div class="title number">Nro</div>
      <div class="title start_time">Lähtöaika</div>
      <div class="title first_name">Etunimi</div>
      <div class="title last_name">Sukunimi</div>
      <div class="title club"><%= club_title @race %></div>
      <div class="title series">Sarja</div>
      <div class="title age_group">Ikäryhmä</div>
      <div class="title button">&nbsp;</div>
      <div class="title">&nbsp;</div>
    </div>
    <%= render :partial => 'competitor_row', :locals => { :c => @new_competitor,
      :save_button => 'Lisää uusi', :id => 'new', :parent => @race } %>
    <div id="ruler"><hr/></div>
    <% @competitors.each do |c| %>
      <%= render :partial => 'competitor_row', :locals => { :c => c,
        :save_button => 'Tallenna', :id => c.id, :parent => c.series } %>
    <% end %>
  </div>
  <%= javascript_tag do %>
    function start_updating(id) {
      $("#status_" + id).html('<%= image_tag 'spinner.gif' %>');
    }
    function change_age_groups(competitor_id, series_id) {
      var $age_group_spinner = $('#age_groups_spinner_' + competitor_id);
      var $age_group_menu = $('#age_groups_' + competitor_id);
      $age_group_menu.hide();
      $age_group_spinner.show();
      $.getJSON('/official/series/' + series_id + '/age_groups', function(age_groups) {
        while($age_group_menu.children().length > 1) {
          $age_group_menu.children().last().remove();
        }
        if(age_groups.length > 0) {
          $.each(age_groups, function(i, age_group) {
            $age_group_menu.append('<option value="' + age_group.id + '">' + age_group.name + '</option>');
          });
          $age_group_menu.show();
        }
        $age_group_spinner.hide();
      });
    }
  <% end %>
  <hr/>
  <div class="action_box"><%= link_to 'Lataa lähtöajat PDF-tiedostona', race_start_lists_path(@race, :format => :pdf) %></div>
<% end %>
