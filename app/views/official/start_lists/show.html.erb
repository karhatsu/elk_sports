<% content_for :title, "Kaikkien kilpailijoiden lähtöajat" %>
<% content_for :page_title, yield(:title) %>
<h2>Kaikkien kilpailijoiden lähtöajat</h2>
<% if @all_series.length == 0 %>
  <div class="info">Yhdellekään sarjalle ei ole luotu vielä lähtölistaa</div>
<% else %>
  <div id="update_error"></div>
  <table>
    <tr>
      <th>Nro</th>
      <th>Lähtöaika</th>
      <th>Etunimi</th>
      <th>Sukunimi</th>
      <th><%= club_title @race %></th>
      <th>Sarja</th>
      <th>Ikäryhmä</th>
      <th>&nbsp;</th>
      <th>&nbsp;</th>
    </tr>
    <%= form_for([:official, @race, @new_competitor], :remote => true) do |f| %>
      <%= render :partial => 'competitor_row',
        :locals => { :f => f, :c => @new_competitor, :save_button => 'Lisää uusi' } %>
    <% end %>
    <% @competitors.each do |c| %>
      <%= form_for([:official, c.series, c], :remote => true) do |f| %>
        <%= render :partial => 'competitor_row',
          :locals => { :f => f, :c => c, :save_button => 'Tallenna' } %>
      <% end %>
    <% end %>
  </table>
  <%= javascript_tag do %>
    function start_updating(id) {
      $("#status_" + id).html('<%= image_tag 'spinner.gif' %>');
    }
    function change_age_groups(competitor_id, series_id) {
      var $age_group_spinner = $('#age_groups_spinner_' + competitor_id);
      var $age_group_menu = $('#age_groups_' + competitor_id);
      $age_group_menu.hide();
      $age_group_spinner.show();
      $.getJSON('/official/series/' + series_id + '/age_groups', function(age_groups) {
        while($age_group_menu.children().length > 1) {
          $age_group_menu.children().last().remove();
        }
        if(age_groups.length > 0) {
          $.each(age_groups, function(i, age_group) {
            $age_group_menu.append('<option value="' + age_group.id + '">' + age_group.name + '</option>');
          });
          $age_group_menu.show();
        }
        $age_group_spinner.hide();
      });
    }
  <% end %>
  <hr/>
  <div class="action_box"><%= link_to 'Lataa lähtöajat PDF-tiedostona', race_start_lists_path(@race, :format => :pdf) %></div>
<% end %>
