<table>
  <tr>
    <th>&nbsp;</th>
    <th><%= t 'attributes.name' %></th>
    <th><%= t 'number_short' %></th>
    <th id="table_club_title"><%= club_title(series.race) %></th>
    <th><%= t(:points) %></th>
  </tr>
  <% prev_rel_points = 1.0/0.0 %>
  <% series.ordered_competitors(params[:all_competitors], params[:sort].to_i).each_with_index do |comp, i| %>
    <tr id="comp_<%= i+1 %>"<%= i % 2 == 0 ? raw(' class="odd"') : '' %>>
      <% @max_points = comp.points(false) if i == 0 %>
      <td><%= "#{i + 1}." unless comp.relative_points == prev_rel_points %></td>
      <td>
        <%= link_to full_name(comp), 'javascript:Void(0);', onclick: "competitorDetails(" + i.to_s + ");" %>
        <%= "(#{comp.age_group.name})" if comp.age_group %>
        <%= raw("<span class='unofficial' title='#{t(:unofficial)}'>" +
            "#{t(:unofficial_short)}</span>") if comp.unofficial? %>
      </td>
      <td><%= comp.number ? comp.number : '' %></td>
      <td><%= comp.club.name %></td>
      <td class="center"><%= points_print(comp, params[:all_competitors]) %>
        <%= national_record(comp) if comp.points.to_i >= @max_points.to_i %>
      </td>
    </tr>
    <tr id="details_<%= i %>" style="display: none;" <%= i % 2 == 0 ? raw(' class="odd"') : '' %>>
      <td colspan="5">
        <% unless series.time_points_type == Series::TIME_POINTS_TYPE_NONE %><%= time_points(comp, true, params[:all_competitors]) %><% end %> |
        <%= series.race.finished ? estimate_points_and_diffs(comp) : estimate_points(comp) %> |
        <%= shot_points(comp, true) %>
      </td>
    </tr>
    <% prev_rel_points = comp.relative_points %>
  <% end %>
</table>
<%= javascript_tag do %>
  function competitorDetails(i) {
    if ($('#details_' + i + ':hidden').length > 0) {
      $('#details_' + i).show();
    } else {
      $('#details_' + i).hide();
    }
  }
<% end %>