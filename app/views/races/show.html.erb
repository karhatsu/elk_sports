<%= content_for(:title, @race.name) %>
<div class="title-and-fb-share race-page">
  <%= render partial: 'shared/facebook_share' %>
</div>
<% unless result_rotation_list(menu_race).empty? %>
  <% content_for(:refresh, true) %>
<% end %>
<% unless @race.home_page.blank? and @race.organizer.blank? and @race.organizer_phone.blank? %>
  <h2><%= t '.organizer_info' %></h2>
  <div class="section">
    <%= organizer_info_with_possible_link(@race) %>
  </div>
<% end %>
<h2><%= t '.single_competitor_competitions' %></h2>
<div class="section">
  <% if @race.series.empty? %>
    <%= t '.no_series_for_race' %>
  <% else %>
    <%= render :partial => 'series_table' %>
    <% if @race.finished? %>
      <% estimates_at_most = @race.estimates_at_most %>
      <h3><%= t '.correct_distances' %></h3>
      <table>
        <tr>
          <th><%= t '.competitor_numbers' %></th>
          <th><%= t :correct_distance %> 1</th>
          <th><%= t :correct_distance %> 2</th>
          <% if estimates_at_most == 4 %>
            <th><%= t :correct_distance %> 3</th>
            <th><%= t :correct_distance %> 4</th>
          <% end %>
        </tr>
        <% @race.correct_estimates.each do |ce| %>
          <tr>
            <td class="center"><%= correct_estimate_range(ce) %></td>
            <td class="center"><%= ce.distance1 %></td>
            <td class="center"><%= ce.distance2 %></td>
            <% if estimates_at_most == 4 %>
              <td class="center"><%= ce.distance3 %></td>
              <td class="center"><%= ce.distance4 %></td>
            <% end %>
          </tr>
        <% end %>
      </table>
    <% end %>
    <h3><%= t '.start_lists_for_all_series_pdf' %></h3>
    <%= form_tag(race_start_lists_path(@race, :format => :pdf), :method => :get) do %>
      <%= select_tag :club_id,
        options_from_collection_for_select(@race.clubs, :id, :name),
        :prompt => "#{t :all} #{clubs_title(@race).downcase}" %>
      <%= submit_tag t('.download_start_times') %>
    <% end %>
  <% end %>
</div>
<% if @race.has_team_competition? and @race.start_date <= Time.zone.today and
    !@race.series.empty? %>
  <h2><%= t 'activerecord.models.team_competition', :count => @race.team_competitions.count %></h2>
  <div class="section">
    <% if @race.team_competitions.count == 1 %>
      <%= link_to t('activerecord.models.team_competition.one'), race_team_competition_path(@race,
        @race.team_competitions.first) %>
    <% else %>
      <table>
        <tr>
          <th><%= t :competition %></th>
          <th><%= t :competitors_per_team %></th>
        </tr>
        <% @race.team_competitions.each do |tc| %>
          <tr>
            <td><%= link_to tc.name, race_team_competition_path(@race, tc) %></td>
            <td class="center"><%= tc.team_competitor_count %></td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>
<% end %>
<% unless @race.relays.empty? %>
  <h2><%= t 'activerecord.models.relay', :count => @race.relays.count %></h2>
  <div class="section">
    <table>
      <tr>
        <th><%= t 'activerecord.models.relay', :count => 1 %></th>
        <th><%= t 'attributes.start_time' %></th>
        <th><%= t '.teams' %></th>
      </tr>
      <% @race.relays.each do |relay| %>
        <tr>
          <td><%= link_to relay.name, race_relay_path(@race, relay) %></td>
          <td><%= relay_start_time_print relay if relay.start_time %></td>
          <td class="center"><%= relay.relay_teams.count %></td>
        </tr>
      <% end %>
    </table>
  </div>
<% end %>
<% unless @race.series.empty? %>
  <h2><%= t '.all_results_pdf' %></h2>
  <div class="section">
    <%= form_tag(race_path(@race, :format => :pdf), :method => :get) do %>
      <%= select_tag :club_id,
        options_from_collection_for_select(@race.clubs, :id, :name),
        :prompt => "#{t :all} #{clubs_title(@race).downcase}" %>
      <%= submit_tag t('.download_all_results') %>
    <% end %>
  </div>
<% end %>
<% if @race.start_date > Time.zone.today %>
  <div class="info">
    <%= t '.competition_begins' %>
    <%= distance_of_time_in_words(Time.zone.today, @race.start_date, false) %>.</div>
<% end %>
<% cup = @race.cups.first unless @race.cups.empty? %>
<% if cup %>
  <h2><%= t 'activerecord.models.cup', :count => 1 %></h2>
  <div class="section"><%= link_to t('.race_belongs_to_cup', :cup_name => cup.name), cup_path(cup) %></div>
<% end %>
<hr/>
<%= link_to t(:back_to_home_page), root_path %>
