<%= content_for(:title, @race.name) %>
<% unless result_rotation_list(menu_race).empty? %>
  <% content_for(:refresh, true) %>
<% end %>
<% unless @race.home_page.blank? %>
  <h2>Lisätietoa kilpailusta</h2>
  <div class="section">
    <a href="<%= link_with_protocol(@race.home_page) %>" target="_blank">Kilpailun
      kotisivut</a>
  </div>
<% end %>
<h2>Yksilökilpailut</h2>
<div class="section">
  <% if @race.series.empty? %>
    Kilpailuun ei ole vielä lisätty sarjoja
  <% else %>
    <%= render :partial => 'series_table' %>
    <h3>Kaikkien sarjojen lähtöajat (PDF)</h3>
    <%= form_tag(race_start_lists_path(@race, :format => :pdf), :method => :get) do %>
      <%= select_tag :club_id,
        options_from_collection_for_select(@race.clubs, :id, :name),
        :prompt => "Kaikki #{clubs_title(@race).downcase}" %>
      <%= submit_tag 'Lataa lähtöajat' %>
    <% end %>
    <% if @race.finished? %>
      <% estimates_at_most = @race.estimates_at_most %>
      <h3>Oikeat arviot</h3>
      <table>
        <tr>
          <th>Kilpailunumerot</th>
          <th>Oikea arvio 1</th>
          <th>Oikea arvio 2</th>
          <% if estimates_at_most == 4 %>
            <th>Oikea arvio 3</th>
            <th>Oikea arvio 4</th>
          <% end %>
        </tr>
        <% @race.correct_estimates.each do |ce| %>
          <tr>
            <td class="center"><%= correct_estimate_range(ce) %></td>
            <td class="center"><%= ce.distance1 %></td>
            <td class="center"><%= ce.distance2 %></td>
            <% if estimates_at_most == 4 %>
              <td class="center"><%= ce.distance3 %></td>
              <td class="center"><%= ce.distance4 %></td>
            <% end %>
          </tr>
        <% end %>
      </table>
    <% end %>
  <% end %>
</div>
<% if @race.has_team_competition? and @race.start_date <= Time.zone.today and
    !@race.series.empty? %>
  <h2>Joukkuekilpailut</h2>
  <div class="section">
    <% if @race.team_competitions.count == 1 %>
      <%= link_to "Joukkuekilpailu", race_team_competition_path(@race,
        @race.team_competitions.first) %>
    <% else %>
      <table>
        <tr>
          <th>Kilpailu</th>
          <th>Kilpailijoita / joukkue</th>
        </tr>
        <% @race.team_competitions.each do |tc| %>
          <tr>
            <td><%= link_to tc.name, race_team_competition_path(@race, tc) %></td>
            <td class="center"><%= tc.team_competitor_count %></td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>
<% end %>
<% unless @race.relays.empty? %>
  <h2>Viestit</h2>
  <div class="section">
    <table>
      <tr>
        <th>Viesti</th>
        <th>Lähtöaika</th>
        <th>Joukkueita</th>
      </tr>
      <% @race.relays.each do |relay| %>
        <tr>
          <td><%= link_to relay.name, race_relay_path(@race, relay) %></td>
          <td><%= series_datetime_print relay, true, true if relay.start_time %></td>
          <td class="center"><%= relay.relay_teams.count %></td>
        </tr>
      <% end %>
    </table>
  </div>
<% end %>
<% unless @race.series.empty? %>
  <h2>Tuloskooste (PDF)</h2>
  <div class="section">
    <div class="info">PDF-tuloskooste sisältää kaikkien kilpailuiden tulokset</div>
    <%= form_tag(race_path(@race, :format => :pdf), :method => :get) do %>
      <%= select_tag :club_id,
        options_from_collection_for_select(@race.clubs, :id, :name),
        :prompt => "Kaikki #{clubs_title(@race).downcase}" %>
      <%= submit_tag 'Lataa tuloskooste' %>
    <% end %>
  </div>
<% end %>
<% if @race.start_date > Time.zone.today %>
  <div class="info">
    Kilpailun alkuun on aikaa
    <%= distance_of_time_in_words(Time.zone.today, @race.start_date, false) %>.</div>
<% end %>
<% cup = @race.cups.first unless @race.cups.empty? %>
<% if cup %>
  <h2>Cup-kilpailu</h2>
  <div class="section">Tämä kilpailu on cup-kilpailun <%= link_to cup.name, cup_path(cup) %> osakilpailu</div>
<% end %>
<hr/>
<%= link_to "Takaisin etusivulle", root_path %>
