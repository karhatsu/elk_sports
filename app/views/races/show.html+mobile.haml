.facebook_share
  = render partial: 'shared/facebook_share'
= content_for(:title, @race.name)
%h1= yield :title
.section
  %span
    #{@race.location}, #{race_date_interval(@race)}
- unless @race.home_page.blank? and @race.organizer.blank? and @race.organizer_phone.blank?
  %h2= t '.organizer_info'
  .section
    = organizer_info_with_possible_link(@race)
- unless @race.public_message.blank?
  %h2 Kilpailun järjestäjä tiedottaa
  %blockquote.public_message
    - markdown = Redcarpet::Markdown.new Redcarpet::Render::HTML
    = raw markdown.render(@race.public_message)
.race-page-column
  %h2= t '.single_competitor_competitions'
  - if @race.start_time_defined? and not @race.finished?
    .section
      Kilpailu alkaa:
      = time_print @race.start_time
  .section
    - if @race.series.empty?
      = t '.no_series_for_race'
    - else
      - show_start_time = @race.start_order == Race::START_ORDER_BY_SERIES
      %table
        %tr
          %th= t :series
          - if show_start_time
            %th= t 'attributes.start_time'
        - @race.series.each do |s|
          %tr{id: "series_#{s.id}"}
            %td.with_primary_link
              = link_to s.name, race_series_path(s.race, s), class: 'primary_link'
            - if show_start_time
              %td
                - if s.start_time
                  = link_to time_print(s.start_datetime), race_series_start_list_path(s.race, s), class: 'secondary_link'
                - else
                  -
      - if @race.finished?
        %h3= t '.correct_distances'
        %table
          - @race.correct_estimates.each do |ce|
            %tr
              %td.center
                #{correct_estimate_range(ce)}:
              %td.center
                = ce.distance1
                \/
                = ce.distance2
                - unless ce.distance3.blank?
                  \/
                  = ce.distance3
                - unless ce.distance4.blank?
                  \/
                  = ce.distance4
.race-page-column
  - if @race.has_team_competition? and @race.start_date <= Time.zone.today and !@race.series.empty?
    %h2
      = t 'activerecord.models.team_competition', :count => @race.team_competitions.count
    .section
      - if @race.team_competitions.count == 1
        = link_to t('activerecord.models.team_competition.one'), race_team_competition_path(@race, @race.team_competitions.first), class: 'primary_link'
      - else
        - @race.team_competitions.each do |tc|
          .list_item
            = link_to tc.name, race_team_competition_path(@race, tc), class: 'primary_link'
  - unless @race.relays.empty?
    %h2
      = t 'activerecord.models.relay', :count => @race.relays.count
    .section
      %table
        - @race.relays.each do |relay|
          %tr
            %td.with_primary_link
              = link_to relay.name, race_relay_path(@race, relay), class: 'primary_link'
            - if relay.start_time
              %td= relay_start_time_print relay
  - if @race.start_date > Time.zone.today
    .info
      = t '.competition_begins'
      = distance_of_time_in_words(Time.zone.today, @race.start_date)
.clear
  - cup = @race.cups.first unless @race.cups.empty?
  - if cup
    %h2= t 'activerecord.models.cup', :count => 1
    .section{style: 'margin-bottom: 30px;'}
      = link_to t('.race_belongs_to_cup', :cup_name => cup.name), cup_path(cup), class: 'secondary_link'
%hr
= link_to t(:back_to_home_page), root_path, class: 'back_link'
