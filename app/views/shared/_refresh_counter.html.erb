<% secs = defined?(seconds) ? seconds : 30 %>
<div id="reload_counter">
  <span id="reload_text">Uusi tulossivu ladataan automaattisesti <span id="secs">...</span>
    <a id="stop" href="javascript:void(0)">Pysäytä laskenta.</a></span>
  <span id="continue_text" style="display: none;">Uuden tulossivun automaattinen lataus pysäytetty.
    <a id="start" href="javascript:void(0)">Ota automaattinen lataus takaisin käyttöön.</a></span>
</div>
<%= javascript_tag do %>
  secs = <%= secs %>;
  function dereaseSeconds() {
    if(secs > 0) {
      $('#stop').show();
      $('#secs').text(secs + ' sekunnin kuluttua.');
      secs--;
    } else {
      $('#stop').hide();
      dots = '..';
      $('#secs').text(dots);
      setInterval(function() {
        dots += '..';
        $('#secs').text(dots);
      }, 500);
      clearInterval(intervalId);
      if(<%= result_rotation_cookie.nil? %>) {
        window.location.reload()
      } else {
        window.location = '<%= next_result_rotation(request.fullpath) %>';
      }
    }
  }
  function continueCounting() {
    intervalId = setInterval('dereaseSeconds()', 1000);
    $('#continue_text').hide();
    $('#reload_text').show();
  }
  function stopCounting() {
    clearInterval(intervalId);
    $('#reload_text').hide();
    $('#continue_text').show();
  }
  $('#stop').click(stopCounting);
  $('#start').click(continueCounting);
  $(document).ready(continueCounting);
<% end %>
